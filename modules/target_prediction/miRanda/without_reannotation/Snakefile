rule expression_filter_miRanda_nr_chr:
    input:
        miRanda_scores="results/targets/miRanda/{species}/nr_chr{chrom}.temp.tsv",
        expression_values="results/salmon/{species}/{tissue}.sf",
    params:
        tpm_expression_threshold=config["TPM_expression_threshold"],
    output:
        temp("results/targets/miRanda/{species}/{tissue}/chr{chrom}.tsv"),
    script:
        "filter_miRanda_scores.R"


if config["context"] != "reference":

    rule expression_filter_miRanda_nr:
        input:
            miRanda_scores="results/targets/miRanda/{species}/nr.temp2.tsv",
            expression_values="results/salmon/{species}/{tissue}.sf",
        params:
            tpm_expression_threshold=config["TPM_expression_threshold"],
            species=config["species"],
            tissue=config["context"],
        output:
            "target_predictions.txt",
        script:
            "filter_miRanda_scores.R"
        wildcard_constraints:
            species=config["species"],
            tissue=config["context"]

elif config["context"] == "reference":

    rule expression_filter_miRanda_nr:
        input:
            miRanda_scores="results/targets/miRanda/{species}/nr.temp2.tsv",
        params:
            species=config["species"],
        output:
            "target_predictions.txt",
        shell:
            "cp {input} {output}"
        wildcard_constraints:
            species=config["species"]
