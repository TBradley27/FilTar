rule expression_filter_miRanda_chr:
    input:
        miRanda_scores=rules.convert_miRanda_to_tsv.output,
        expression_values=rules.salmon_average_quantmerge_samples.output,
    params:
        tpm_expression_threshold=config["TPM_expression_threshold"],
    output:
        temp("results/targets/miRanda/{species}/{tissue_tx_exp}/chr{chrom}.tsv"),
    script:
        "filter_miRanda_scores.R"


rule expression_filter_miRanda:
    input:
        miRanda_scores=rules.add_miRanda_header.output,
        expression_values=rules.salmon_average_quantmerge_samples.output,
    params:
        tpm_expression_threshold=config["TPM_expression_threshold"],
        species=config["species"],
        tissue_tx_exp=config["context"],
    wildcard_constraints:
        tissue_tx_exp="((?!temp).)*",
        species=config["species"],
    output:
        "target_predictions.txt",
    script:
        "filter_miRanda_scores.R"
