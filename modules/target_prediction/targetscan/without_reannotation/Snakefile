rule expression_filter_contextpp_scores_chr_no_reannotation:
    input:
        contextpp_scores="results/targets/{species}_nr_chr{chrom}_msa.contextpp.tmp.tsv",
        expression_values=rules.salmon_average_quantmerge_samples.output,
    params:
        tpm_expression_threshold=config["TPM_expression_threshold"],
    output:
        temp("results/targets/{species}/{tissue_tx_exp}_chr{chrom}.contextpp.tsv"),
    script:
        "filter_contextpp_scores.R"


if config["context"] != "reference":

    rule expression_filter_contextpp_scores_no_reannotation:
        input:
            contextpp_scores=rules.aggregate_contextpp_scores.output,
            expression_values=rules.salmon_average_quantmerge_samples.output,
        params:
            tpm_expression_threshold=config["TPM_expression_threshold"],
            species=config["species"],
            tissue_tx_exp=config["context"],
        wildcard_constraints:
            species=config["species"],
            tissue_tx_exp=config["context"],
        output:
            "target_predictions.txt",
        script:
            "filter_contextpp_scores.R"

elif config["context"] == "reference":

    rule expression_filter_contextpp_scores_no_reannotation:
        input:
            contextpp_scores=rules.aggregate_contextpp_scores.output,
        params:
            species=config["species"],
        wildcard_constraints:
            species=config["species"],
        output:
            "target_predictions.txt",
        shell:
            "cp {input} {output}"
